function processAjaxData(a){window.history.pushState({},"",a)}function onScroll(){var a=$(document).scrollTop();a>=37?$(".top-nav").addClass("fixed"):$(".top-nav").removeClass("fixed")}function pinLink(){1==user_status?$(".js-top-pin").html('<span class="p-link js-ovl-open" data-form="true" data-ovl-url="/pin/_index">ввести пин-код</span>'):2==user_status?$(".js-top-pin").html('<span class="p-link js-ovl-open js-login-btn" data-class="ovl--short" data-ovl-link="ovl-reg-main">ввести пин-код</span>'):$(".js-top-pin").html('<span class="p-link js-ovl-open js-login-btn" data-form="true" data-ovl-link="ovl-reg">ввести пин-код</span>')}function receiveMessage(a){if("https://games.mail.ru"==a.origin){var b=$.parseJSON(a.data);"closeWindow"==b.action&&Ovl.close(),"payReceived"==b.action&&(initBlock("/user/_auth",!0),dataLayer.push({event:"MainEvent",category:"Purchase",action:"PurchaseFinish",price:"750",currency:"RUB",itemname:"игра PLAYERUNKNOWNS BATTLEGROUNDS",UserID:user_data.csaid}))}}var $d,Registration,cookie_live,unixtime,user_status;$d=$(document),user_status=null,unixtime=Math.floor(Date.now()/1e3)+86400,cookie_live=new Date((new Date).getTime()+15e4),document.write('<script src="//games.mail.ru/js/kit_client.js?r='+Math.random()+'"></script>'),Registration={back_url:null,form_url:null,email_hint:null,pass_hint:null,check_email:!1,check_pass:!1,user_hash:null,project:"pubg",init:function(a){return Registration.back_url=a&&a.back_url?a.back_url:window.location.href,Registration.email_hint=a&&a.email_hint?a.email_hint(esle('Укажите почтовый ящик Mail.Ru, если у вас нет такого - <span class="p-link js-reg-newmail">создайте тут</span>')):void 0,Registration.pass_hint=a&&a.pass_hint?a.pass_hint(esle('Введите пароль от почты, если забыли, <a href="https://e.mail.ru/password/restore/">восстановите его тут</a>')):void 0,$(".js-reg-email-note-text").html(Registration.email_hint),$(".js-reg-pass-note-text").html(Registration.pass_hint),Registration.checkStatus()},checkStatus:function(){return $.ajax({url:"/landing/_status",type:"GET",dataType:"json",success:function(a){switch(user_status=a.status,Registration.user_hash=a.hash,user_status){case 0:$(".js-reg-form").attr("action","https://auth.mail.ru/cgi-bin/auth?FakeAuthPage=https%3A%2F%2F"+Registration.project+".mail.ru%2F&Page="+encodeURIComponent("https://"+Registration.project+".mail.ru/landing/_register?hash="+Registration.user_hash+"&r="+encodeURI(Registration.back_url))),GMR.config({page:"https://"+Registration.project+".mail.ru/landing/_register?hash="+Registration.user_hash+"&r="+encodeURI(Registration.back_url)})}$d.trigger("Reg_checkStatus",[a])},error:function(a){Registration.processError(a)}})},processError:function(a){var b,c;c=!1;try{(c=$.parseJSON(a.responseText)).sdc&&$.ajax({url:"https://auth.mail.ru/sdc",jsonp:"JSONP_call",data:{from:c.host},dataType:"jsonp",success:function(){Registration.checkStatus()},error:function(a){console.log(a)}})}catch(c){b=c,console.log(a,b)}},getEmail:function(){var a,b;return a=$(".js-reg-email").val(),b=$(".js-reg-domen").val(),!!a.length&&(a.indexOf("@")>=0?a:a+"@"+b)},verifyEmail:function(){return $(".js-reg-email").val().length?$.ajax({async:!1,type:"POST",url:"/user/_check?do=email",dataType:"json",data:{email:Registration.getEmail()},success:function(a){return a.valid?($(".js-reg-email-note-status").removeClass("error success warning"),$(".js-reg-email-note-text").html(""),(a.partner=1)?Registration.check_email=!0:Registration.check_email=!1):(Registration.check_email=!1,$(".js-reg-email-note-status").removeClass("error success warning"),(a.status=3)&&($(".js-reg-email-note-status").addClass("warning"),a.error='Такой email уже зарегистрирован. <span class="link js-reg-">Авторизуйтесь тут</span>.'),(a.status=5)&&($(".js-reg-email-note-status").addClass("error"),a.error='Регистрация возможна только с почтовой Mail.Ru. Нет такой? <span class="p-link js-reg-newmail">Создайте тут</span>'),$(".js-reg-email-note-text").html(a.error)),$d.trigger("Reg_checkEmail",[a])},fail:function(){return $(".js-reg-email-note-status").removeClass("error success warning"),$(".js-reg-email-note-status").addClass("error"),$(".js-reg-email-note-text").html("Попробуйте еще раз!")}}):($(".js-reg-email-note-status").addClass("error"),$(".js-reg-email-note-text").html('Укажите почтовый ящик Mail.Ru, если у вас нет такого - <span class="p-link js-reg-newmail">создайте тут</span>'),Registration.check_email=!1,!1)},verifyEmailPass:function(){return $(".js-reg-pass").val().length?$.ajax({async:!1,type:"POST",url:"/user/_check?do=mailru_password",dataType:"json",data:{email:Registration.getEmail(),password:$(".js-reg-pass").val()},success:function(a){return a.valid?($(".js-reg-pass-note-status").removeClass("error success warning"),$(".js-reg-pass-note-status").addClass("success"),$(".js-reg-pass-note-text").html(""),Registration.check_pass=!0):($(".js-reg-pass-note-status, .js-reg-email-note-status").removeClass("error success warning"),$(".js-reg-pass-note-status, .js-reg-email-note-status").addClass("error"),$(".js-reg-pass-note-text").html('Ошибка в пароле или почте. Если забыли пароль, <a href="https://e.mail.ru/password/restore/">восстановите его тут</a>'),Registration.check_pass=!1),$d.trigger("Reg_checkPass",[a])},fail:function(){return $(".js-reg-pass-note-status").removeClass("error success warning"),$(".js-reg-pass-note-status").addClass("error"),$(".js-reg-pass-note-text").html("Попробуйте еще раз!")}}):($(".js-reg-pass-note-status").removeClass("error success warning"),$(".js-reg-pass-note-status").addClass("error"),$(".js-reg-pass-note-text").html('Введите пароль от почты, если забыли, <a href="https://e.mail.ru/password/restore/">восстановите его тут</a>'),Registration.check_pass=!1,!1)},verifyKey:function(a){var b,c;b=a.which?a.which:a.keyCode,c=a.shiftKey?a.shiftKey:16===b,b>=1072&&b<=1103||b>=1040&&b<=1071?($(".js-reg-pass-note-status").removeClass("error success warning"),$(".js-reg-pass-note-status").addClass("warning"),$(".js-reg-pass-note-text").html("Включена русская раскладка клавиатуры!")):b>=65&&b<=90&&!c||b>=97&&b<=122&&c?($(".js-reg-pass-note-status").removeClass("error success warning"),$(".js-reg-pass-note-status").addClass("warning"),$(".js-reg-pass-note-text").html("Внимание! Включен CAPS LOCK!")):($(".js-reg-pass-note-status").removeClass("error success warning"),$(".js-reg-pass-note-text").html(Registration.pass_hint))},getCookie:function(a){var b;return(b=document.cookie.match(new RegExp("(?:^|; )"+a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)")))?decodeURIComponent(b[1]):void 0},fastReg:function(){return document.cookie="confirm_reg="+unixtime+"; path=/;",document.cookie="show_regdone=true; expires="+cookie_live.toUTCString()+"; path=/;",$.ajax({url:"/user/_register?hash="+Registration.user_hash,type:"get",dataType:"json",success:function(a){if(a.status="ok")return dataLayer.push({event:"MainEvent",category:"Registration",action:"RegistrationFinish"}),$d.trigger("Reg_Complete",[a]),window.location.href=Registration.back_url},fail:function(){return console.log("Произошла ошибка регистрации. Попробуйте перезагрузить страницу.")}})},regSubmit:function(){return Registration.verifyEmail(),Registration.verifyEmailPass(),!!Registration.check_email&&!!Registration.check_pass&&(document.cookie="confirm_reg="+unixtime+"; path=/;",document.cookie="show_regdone=true; expires="+cookie_live.toUTCString()+"; path=/;",dataLayer.push({event:"MainEvent",category:"Registration",action:"RegistrationFinish"}),$d.trigger("Reg_Submit"),!0)},logout:function(a){return $.ajax({url:"/landing/_logout",type:"POST",dataType:"json",success:function(b){if(b.status="ok")return a?$d.trigger("Reg_ChangeUser",[b]):$d.trigger("Reg_Logout",[b])},fail:function(){return console.log("Произошла ошибка. Попробуйте перезагрузить страницу.")}})}},$d.on("click",".js-reg-vk",function(){return GMR.showVKSigninForm(),document.cookie="confirm_reg="+unixtime+"; path=/;",document.cookie="show_regdone=true; expires="+cookie_live.toUTCString()+"; path=/;",!1}),$d.on("click",".js-reg-ok",function(){return GMR.showOKSigninForm(),document.cookie="confirm_reg="+unixtime+"; path=/;",document.cookie="show_regdone=true; expires="+cookie_live.toUTCString()+"; path=/;",!1}),$d.on("click",".js-reg-auth",function(){return GMR.showSigninForm(),document.cookie="confirm_reg="+unixtime+"; path=/;",document.cookie="show_regdone=true; expires="+cookie_live.toUTCString()+"; path=/;",!1}),$d.on("click",".js-reg-newmail",function(){return GMR.showSignupForm(),document.cookie="confirm_reg="+unixtime+"; path=/;",document.cookie="show_regdone=true; expires="+cookie_live.toUTCString()+"; path=/;",!1}),$d.on("click",".js-reg-download",function(){return GMR.detectAndDownload(),!1}),$d.on("click",".js-reg-steam",function(){return GMR.showSTSigninForm(),!1}),$d.on("click",".js-reg-fast",function(){return Registration.fastReg()}),$d.on("click",".js-reg-submit",function(){return Registration.regSubmit()}),$d.on("click",".js-reg-change-user",function(){return Registration.logout(!0)}),$d.on("click",".js-reg-logout",function(){return Registration.logout(!1)}),$d.on("Reg_changeUrls",function(a,b){return $(".js-reg-form").attr("action",b.form_url),GMR.config({page:b.gmr_url})}),$d.on("change",".js-reg-email",function(){return Registration.verifyEmail()}),$d.on("change",".js-reg-pass",function(){return Registration.verifyEmailPass()}),$d.on("keypress",".js-reg-pass",function(a){return Registration.verifyKey(a,$(this))});var pinOn=!1,pincodeAnchor=function(a){location.href.match(/\?.*?pincode/)?(pinOn=!0,"reg"==a?Ovl.open("block",$("#regform"),!0):"doreg"==a?Ovl.open("block",$("div[data-ovl-target=ovl-reg-main]","","ovl--short")):Ovl.open("ajax","/pin/_index","","",pinSet)):location.href.match(/\?.*?buy/)?"reg"==a?Ovl.open("block",$("#regform")):"doreg"==a?Ovl.open("block",$("div[data-ovl-target=ovl-reg-main]","","ovl--short")):Ovl.open("ajax","/user/_payment","","ovl--payment"):location.href.match(/\?.*?loginerror/)&&"reg"==a&&(processAjaxData(self.location.origin+self.location.pathname),Ovl.open("block",$("#regform"),!0,"ovl--signin"),$(".js_kit_signin__box__login").after('<div class="reg-error">Неверный логин или пароль</div>'))},pinSet=function(){var a="";(matches=location.href.match(/pincode=([^&]+|$)/))&&(a=matches[1],$(".js-pin-input").val(a),$(".js-pin .btn").removeClass("disabled"))};$(document).on("click",".js-spoiler",function(){$(this).toggleClass("opened"),$(this).next().slideToggle("fast")}),$(document).on("click",".js-modal",function(a){var b=$(this).attr("href");return window.open(b,"","width=800, height=600, toolbar=no, scrollbars=yes"),!1}),$(document).on("click",".js-select",function(){$(this).hasClass("disabled")||$(this).toggleClass("opened")}),$(document).on("click",function(a){$(a.target).hasClass("js-select")||$(a.target).parents(".js-select-wrap").length||$(".js-select.opened").trigger("click")}),$(document).on("click",".js-tab",function(){var a=$(this).data("tabs"),b=$(".js-tab[data-tabs="+a+"]"),c=b.index($(this));b.removeClass("active"),$(this).addClass("active"),$("div[data-tabs-set="+a+"]").addClass("none"),$(this).data("target")?$("div[data-tabs-target="+$(this).data("target")+"]").removeClass("none"):$("div[data-tabs-set="+a+"]").eq(c).removeClass("none")}),$(document).on("scroll",onScroll),$(document).ready(function(){$(".addthis_toolbox a").attr("href","javascript:void(0)"),onScroll(),GMR.config({ok_enabled:!0,vk_enabled:!0,gc_id:"0.2000297",st_app_id:"2000297",download_url:"http://static.dl.mail.ru/PubgLoader.exe",fake_auth_page:""})}),dataLayer=[],$(document).on("click",".js-ovl-open[data-ovl-link=ovl-reg]",function(){dataLayer.push({event:"MainEvent",category:"Registration",action:"RegistrationStart"})}),$(document).on("click",".js-buy-btn",function(){1!=pinOn?(GMR.config({page:location.href+"?payment"}),Registration.init({back_url:location.href+"?payment"}),$(".js-reg-page").val(location.href+"?payment")):$(".js-reg-page").val(location.href),dataLayer.push({event:"MainEvent",action:"RegisterButtonPress"})}),$(document).on("click",".js-reg-tab",function(){$(".ovl").toggleClass("ovl--signin")}),$(document).on("click",".js-login-btn",function(){GMR.config({page:location.href}),Registration.init({back_url:location.href}),$(".js-reg-page").val(location.href)}),$(document).on("click",".js-gt-payment",function(){dataLayer.push({event:"MainEvent",category:"Purchase",action:"PurchaseStart",price:"750",currency:"RUB",itemname:"игра PLAYERUNKNOWNS BATTLEGROUNDS",UserID:user_data.csaid})}),$(document).on("Reg_Complete",function(a,b){dataLayer.push({event:"MainEvent",category:"Registration",action:"RegistrationFinish"}),Ovl.close(),initBlock("/user/_auth",!0)}),$(document).on("Reg_Submit",function(a,b){dataLayer.push({event:"MainEvent",category:"Registration",action:"RegistrationFinish"})}),$(document).on("Reg_Logout",function(a,b){initBlock("/user/_auth",!0)});var user_data;$(document).on("Reg_checkStatus",function(a,b){if(pinLink(),user_data=b,1==user_status)location.href.match(/\?.*?payment/)&&(Ovl.open("ajax","/user/_payment","","ovl--payment"),processAjaxData(self.location.origin+self.location.pathname)),dataLayer.push({event:"MainEvent",category:"Login",action:"VisitWithLogin",UserID:b.csaid});else if(2==user_status&&!document.cookie.match(/confirm_reg=\d+;?/)){Ovl.open("block",$(".do-reg"),"","ovl--short");var c=new Date((new Date).getTime()+6e5);document.cookie="confirm_reg=1; expires="+c.toUTCString()+"; path=/;"}}),$(document).on("Reg_ChangeUser",function(a,b){initBlock("/user/_auth",!0),$(document).on("Regform_Loaded",function(a,b){Ovl.open("block",$("#regform"),!0,"ovl--signin")})});var regLoaded=function(){$(document).trigger("Regform_Loaded")};window.addEventListener("message",receiveMessage);var Ovl={target:null,gallery:{set:"",elements:null,index:null},wrapper:{main:'<div class="ovl-wrap">              <div class="ovl">              </div><div class="middle"></div>            </div>',fade:'<div class="ovl-fade"></div>',arrows:'<div class="icon-wrap icon-wrap--xsm slider-arrow-left"><i class="icon icon--xsm icon--arr-left"></i><div class="b-link js-gallery-nav" data-direction="prev"></div></div>               <div class="icon-wrap icon-wrap--xsm slider-arrow-right"><i class="icon icon--xsm icon--arr-right"></i><div class="b-link js-gallery-nav" data-direction="next"></div></div>',close:'<i class="icon icon--lg icon--close ovl-close js-ovl-close"></i>'},open:function(a,b,c,d,e){switch(Ovl.wrapCreate(),d&&$(".ovl").addClass(d),1==c&&$(".ovl-wrap").addClass("ovl-form"),a){case"click":if($(b).data("video"))Ovl.video($(b).data("video"));else if($(b).data("gallery-url"))Ovl.gallery.set=$(b).data("gallery-set"),$(".ovl").append('<img src="'+$(b).data("gallery-url")+'">'+Ovl.wrapper.close),Ovl.gallery.elements=$("content").find('div[data-gallery-set="'+Ovl.gallery.set+'"]'),Ovl.gallery.elements.length>1&&$(".ovl").append(Ovl.wrapper.arrows),Ovl.gallery.index=Ovl.gallery.elements.index($(b));else if($(b).data("ovl-url")){var f=$(b).attr("data-ovl-url");Ovl.loadAjax(f,e)}else Ovl.target=$("div[data-ovl-target="+$(b).data("ovl-link")+"]"),Ovl.loadHiddenBlock(Ovl.target);break;case"ajax":Ovl.loadAjax(b,e);break;case"block":Ovl.loadHiddenBlock(b);break;case"video":Ovl.video(b)}},wrapCreate:function(){$(".ovl-wrap").length?(Ovl.moveContentBack(),$(".ovl").attr("class","ovl").html("")):$("body").append(Ovl.wrapper.fade).addClass("ovl-opened").append(Ovl.wrapper.main)},loadHiddenBlock:function(a){Ovl.target=a,a.find("> div").appendTo(".ovl"),$(".ovl").append(Ovl.wrapper.close)},loadAjax:function(a,b){Ovl.target=null;var c=$(".ovl"),d=a;d.length>0&&$.ajax({url:d,type:"GET",dataType:"html"}).done(function(a){c.prepend(a),b&&b()}).then(function(){c.append(Ovl.wrapper.close)}).fail(function(){})},close:function(){$(".ovl-wrap").hasClass("ovl-form")&&($(".input-error").remove(),$(".ovl-wrap").find(".error").removeClass("error")),Ovl.moveContentBack(),$(".ovl-fade").remove(),$(".ovl-wrap").remove(),$("body").removeClass("ovl-opened")},moveContentBack:function(){null!=Ovl.target&&(Ovl.target.append($(".ovl").html()),Ovl.target.find(".icon.js-ovl-close").remove(),Ovl.target=null)},video:function(a){$(".ovl").addClass("ovl--video").append('<div class="ovl-video"><iframe width="100%" height="100%" frameborder="0" allowfullscreen src="https://www.youtube.com/embed/'+a+'?rel=0&autoplay=1"></iframe></div>'+Ovl.wrapper.close),Ovl.resize()},resize:function(){var a=.8,b=$(".ovl-fade").width(),c=$(".ovl-fade").height(),d=0,e=0;c/9>b/16?(e=b*a,d=Math.ceil(e/16*9)):(d=c*a,e=Math.ceil(d/9*16)),$(".ovl-video").css("width",e+"px").css("height",d+"px")},galleryNav:function(a){switch(a){case"prev":Ovl.gallery.index=0==Ovl.gallery.index?Ovl.gallery.elements.length-1:Ovl.gallery.index-1;break;case"next":Ovl.gallery.index=Ovl.gallery.index==Ovl.gallery.elements.length-1?0:Ovl.gallery.index+1}$(".ovl img").attr("src",Ovl.gallery.elements.eq(Ovl.gallery.index).data("gallery-url"))}};$(document).on("click",".js-ovl-open",function(a){var b=!!$(this).data("form"),c=$(this).data("class")?$(this).data("class"):"";Ovl.open("click",a.target,b,c)}),$(document).on("click",".js-gallery-nav",function(a){var b=$(this).data("direction");Ovl.galleryNav(b)}),$(document).on("click",".js-ovl-close",function(a){Ovl.close()}),$(document).on("click",".ovl-wrap",function(a){if(a.target==this){if($(this).hasClass("ovl-form"))return!1;Ovl.close()}}),$(document).on("keyup",function(a){if($("body").hasClass("ovl-opened"))switch(a.keyCode){case 27:Ovl.close();break;case 39:Ovl.galleryNav("next");break;case 37:Ovl.galleryNav("prev")}}),$(window).on("resize",function(){$("body").hasClass("ovl-opened")&&$(".ovl-video").length&&Ovl.resize()});